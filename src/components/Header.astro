---
import { ExternalLinks } from "../data/constants";

const navItems = [
  {
    title: 'Home',
    path: '/',
    subPaths: []
  },
  {
    title: 'Departments',
    path: '#', // Dropdown trigger
    subPaths: [
      { title: 'Paathshala', path: '/pathshala' },
      { title: 'Collect Distribution Kure', path: '/collectdkure' },
      { title: 'Arts & Crafts', path: '/art-and-craft' }
    ]
  },
  {
    title: 'Contact Us',
    path: '/contact',
    subPaths: []
  }
];

const currentPath = Astro.url.pathname;
---

<header class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-gray-100 transition-all duration-300">
  <div class="container mx-auto px-4">
    <nav class="flex h-20 items-center justify-between">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-2 group">
        <img src="/images/logo.png" loading="lazy" alt="Koshish Family Logo" class="w-12 h-auto transition-transform duration-300 group-hover:scale-110" width="48" height="48">
        <span class="font-heading font-bold text-xl text-gray-900 hidden sm:block">
          Koshish<span class="text-primary">Family</span>
        </span>
      </a>
      
      <!-- Desktop Menu -->
      <div class="hidden md:flex items-center space-x-8">
        {navItems.map((item) => (
          item.subPaths.length > 0 ? (
            <div class="dropdown-container group relative flex h-full cursor-pointer items-center space-x-1 font-medium text-gray-600 hover:text-primary transition-colors py-2">
              <span class={`dropdown-trigger ${currentPath.startsWith(item.path) && item.path !== '#' ? 'text-primary font-semibold' : ''}`}>
                {item.title}
              </span>
              <svg xmlns="http://www.w3.org/2000/svg" class="dropdown-arrow h-4 w-4 transition-transform duration-200 group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
              
              <!-- Dropdown -->
              <div class="dropdown-menu absolute top-full right-0 pt-2 w-56 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform translate-y-2 group-hover:translate-y-0">
                <div class="bg-white rounded-xl shadow-xl border border-gray-100 overflow-hidden p-2">
                  {item.subPaths.map((subItem) => (
                    <a href={subItem.path} class="block px-4 py-2 text-sm text-gray-600 rounded-lg hover:bg-blue-50 hover:text-primary transition-colors">
                      {subItem.title}
                    </a>
                  ))}
                </div>
              </div>
            </div>
          ) : (
            <a href={item.path} class={`font-medium transition-colors hover:text-primary ${currentPath === item.path ? 'text-primary font-semibold' : 'text-gray-600'}`}>
              {item.title}
            </a>
          )
        ))}
        
        <a href={ExternalLinks.forms.donation} class="btn btn-primary btn-sm ml-4">
          Donate Now
        </a>
      </div>

      <!-- Mobile Menu Toggle -->
      <div class="md:hidden">
        <button id="mobile-menu-toggle" aria-label="Toggle menu" class="p-2 text-gray-600 hover:text-primary transition-colors rounded-lg hover:bg-gray-100">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </nav>
  </div>

  <!-- Mobile Menu Overlay -->
  <div id="mobile-menu" class="hidden fixed inset-0 z-100 bg-white transform transition-transform duration-300 md:hidden">
    <div class="p-4 flex justify-between items-center border-b border-gray-100 bg-white">
      <span class="font-heading font-bold text-xl text-gray-900">Menu</span>
      <button id="mobile-menu-close" class="p-2 text-gray-500 hover:text-gray-900 rounded-lg hover:bg-gray-100">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    <div class="p-4 space-y-4 overflow-y-auto h-[calc(100vh-70px)] bg-white">
      {navItems.map((item) => (
        item.subPaths.length > 0 ? (
          <div class="space-y-2">
            <div class="font-semibold text-gray-900 px-2">{item.title}</div>
            <div class="pl-4 space-y-2 border-l-2 border-gray-100 ml-2">
              {item.subPaths.map((subItem) => (
                <a href={subItem.path} class="block px-2 py-2 text-gray-600 hover:text-primary hover:bg-blue-50 rounded-lg transition-colors">
                  {subItem.title}
                </a>
              ))}
            </div>
          </div>
        ) : (
          <a href={item.path} class="block px-2 py-3 font-medium text-gray-900 hover:text-primary hover:bg-blue-50 rounded-lg transition-colors">
            {item.title}
          </a>
        )
      ))}
      <div class="pt-4 border-t border-gray-100">
        <a href="/donate" class="btn btn-primary w-full justify-center">
          Donate Now
        </a>
      </div>
    </div>
  </div>
</header>

<script>
  const toggleBtn = document.getElementById('mobile-menu-toggle');
  const closeBtn = document.getElementById('mobile-menu-close');
  const mobileMenu = document.getElementById('mobile-menu');

  function toggleMenu() {
    if (mobileMenu) {
      mobileMenu.classList.toggle('hidden');
      document.body.classList.toggle('overflow-hidden');
    }
  }

  if (toggleBtn) toggleBtn.addEventListener('click', toggleMenu);
  if (closeBtn) closeBtn.addEventListener('click', toggleMenu);
  
  // Ensure menu is closed on page load/navigation
  if (mobileMenu) {
    mobileMenu.classList.add('hidden');
    document.body.classList.remove('overflow-hidden');
  }

  // Dropdown functionality for touch devices
  document.addEventListener('DOMContentLoaded', function() {
    const dropdownContainers = document.querySelectorAll('.dropdown-container');
    
    dropdownContainers.forEach(container => {
      const trigger = container.querySelector('.dropdown-trigger');
      const menu = container.querySelector('.dropdown-menu');
      const arrow = container.querySelector('.dropdown-arrow');
      
      if (trigger && menu) {
        // Toggle dropdown on click/touch
        trigger.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          // Close other open dropdowns
          dropdownContainers.forEach(otherContainer => {
            if (otherContainer !== container) {
              const otherMenu = otherContainer.querySelector('.dropdown-menu');
              const otherArrow = otherContainer.querySelector('.dropdown-arrow');
              if (otherMenu) {
                otherMenu.classList.remove('opacity-100', 'visible', 'translate-y-0');
                otherMenu.classList.add('opacity-0', 'invisible', 'translate-y-2');
              }
              if (otherArrow) {
                otherArrow.classList.remove('rotate-180');
              }
            }
          });
          
          // Toggle current dropdown
          const isOpen = menu.classList.contains('opacity-100');
          if (isOpen) {
            menu.classList.remove('opacity-100', 'visible', 'translate-y-0');
            menu.classList.add('opacity-0', 'invisible', 'translate-y-2');
            if (arrow) arrow.classList.remove('rotate-180');
          } else {
            menu.classList.add('opacity-100', 'visible', 'translate-y-0');
            menu.classList.remove('opacity-0', 'invisible', 'translate-y-2');
            if (arrow) arrow.classList.add('rotate-180');
          }
        });
      }
    });
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', function(e) {
      const target = e.target as Element;
      if (target && !target.closest('.dropdown-container')) {
        dropdownContainers.forEach(container => {
          const menu = container.querySelector('.dropdown-menu');
          const arrow = container.querySelector('.dropdown-arrow');
          if (menu) {
            menu.classList.remove('opacity-100', 'visible', 'translate-y-0');
            menu.classList.add('opacity-0', 'invisible', 'translate-y-2');
          }
          if (arrow) {
            arrow.classList.remove('rotate-180');
          }
        });
      }
    });
    
    // Close dropdowns on escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        dropdownContainers.forEach(container => {
          const menu = container.querySelector('.dropdown-menu');
          const arrow = container.querySelector('.dropdown-arrow');
          if (menu) {
            menu.classList.remove('opacity-100', 'visible', 'translate-y-0');
            menu.classList.add('opacity-0', 'invisible', 'translate-y-2');
          }
          if (arrow) {
            arrow.classList.remove('rotate-180');
          }
        });
      }
    });
  });
</script>
